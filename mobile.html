<!-- æ”¾åœ¨ <body> é‡Œåˆé€‚ä½ç½®ï¼ˆå»ºè®®å¯¼èˆªä¸Šæ–¹ï¼‰ -->
<section id="pano-wrap" style="position:relative;height:70vh;border-radius:12px;overflow:hidden;background:#111;margin:12px 0;">
  <button id="enter360"
    style="position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
           padding:12px 16px;border-radius:999px;border:1px solid #333;background:#0b0b0b;color:#fff;
           font-weight:600">è¿›å…¥å…¨æ™¯</button>
  <div id="m-pano" hidden style="position:absolute;inset:0;"></div>
</section>

<!-- Pannellum è„šæœ¬ï¼ˆè‹¥é¡µé¢é‡Œå·²æœ‰å°±ä¸å¿…å†å¼•å…¥ï¼‰ -->
<script src="https://cdn.jsdelivr.net/npm/pannellum/build/pannellum.js"></script>
<script>
  // æ˜¯å¦æ”¯æŒ WebPï¼ˆç®€æ˜“æ£€æµ‹ï¼‰
  var supportsWebP = (function(){
    try { return document.createElement('canvas').toDataURL('image/webp').indexOf('data:image/webp') === 0; }
    catch(e){ return false; }
  })();

  // ğŸ‘‡ æŠŠè¿™ä¸¤è¡Œæ¢æˆä½ ä¸ºæ‰‹æœºå‡†å¤‡çš„è½»é‡å›¾åœ°å€ï¼ˆä¼˜å…ˆ webpï¼Œå…¶æ¬¡ jpgï¼‰
  var panoMobileWebP = 'æ‰‹æœº-01.webp';  // å»ºè®® 4096x2048ï¼Œ2-5MB
  var panoMobileJPG  = 'æ‰‹æœº-01.jpg';
  var panoURL = supportsWebP ? panoMobileWebP : panoMobileJPG;

  // ç‚¹æŒ‰é’®å†åˆå§‹åŒ–å…¨æ™¯ï¼Œé¿å…é¦–å±å‹åŠ›
  document.getElementById('enter360').addEventListener('click', function(){
    var btn = this;
    btn.disabled = true; btn.textContent = 'åŠ è½½ä¸­â€¦';

    // WebGL èƒ½åŠ›æ£€æµ‹ï¼ˆå¤±è´¥åˆ™å…œåº•ï¼‰
    try {
      var c = document.createElement('canvas');
      var gl = c.getContext('webgl') || c.getContext('experimental-webgl');
      if (!gl) throw new Error('No WebGL');
    } catch(e) {
      document.getElementById('m-pano').innerHTML =
        '<div style="color:#fff;display:grid;place-items:center;height:100%;">è®¾å¤‡ä¸æ”¯æŒå…¨æ™¯é¢„è§ˆã€‚<a href="index.html?desktop=1" style="color:#ff4d4f">è¯•è¯•æ¡Œé¢ç‰ˆ</a></div>';
      btn.remove();
      document.getElementById('m-pano').hidden = false;
      return;
    }

    var el = document.getElementById('m-pano');
    el.hidden = false; btn.remove();

    try {
      pannellum.viewer('m-pano', {
        type: 'equirectangular',
        panorama: panoURL,
        autoLoad: true,
        showControls: true,

        // æ€§èƒ½å‹å¥½ï¼šå›ºå®šè§†åœºè§’ï¼Œå‡å°‘ç¼©æ”¾å¸¦æ¥çš„å¼€é”€
        mouseZoom: false, keyboardZoom: false, doubleClickZoom: false, showZoomCtrl: false,
        hfov: 90, minHfov: 90, maxHfov: 90,

        // åˆç†çš„åˆå§‹ä¸é™åˆ¶
        yaw: 0, pitch: 10, minYaw: -100, maxYaw: 100, minPitch: -40, maxPitch: 45,
        compass: false,

        // å¯é€‰ï¼šæ‰“å¼€é‡åŠ›æ„Ÿåº”ï¼ˆæœ‰äº› iOS éœ€æ‰‹åŠ¨å…è®¸ï¼‰
        orientationOnByDefault: true
      });
    } catch (e) {
      el.innerHTML =
        '<div style="color:#fff;display:grid;place-items:center;height:100%;">åŠ è½½å¤±è´¥ï¼Œå¯èƒ½æ˜¯å›¾ç‰‡è·¨åŸŸæˆ–è¿‡å¤§ã€‚<a href="index.html?desktop=1" style="color:#ff4d4f">è½¬åˆ°æ¡Œé¢ç‰ˆ</a></div>';
    }
  });
</script>
