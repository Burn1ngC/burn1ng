<!-- 放在 <body> 里合适位置（建议导航上方） -->
<section id="pano-wrap" style="position:relative;height:70vh;border-radius:12px;overflow:hidden;background:#111;margin:12px 0;">
  <button id="enter360"
    style="position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
           padding:12px 16px;border-radius:999px;border:1px solid #333;background:#0b0b0b;color:#fff;
           font-weight:600">进入全景</button>
  <div id="m-pano" hidden style="position:absolute;inset:0;"></div>
</section>

<!-- Pannellum 脚本（若页面里已有就不必再引入） -->
<script src="https://cdn.jsdelivr.net/npm/pannellum/build/pannellum.js"></script>
<script>
  // 是否支持 WebP（简易检测）
  var supportsWebP = (function(){
    try { return document.createElement('canvas').toDataURL('image/webp').indexOf('data:image/webp') === 0; }
    catch(e){ return false; }
  })();

  // 👇 把这两行换成你为手机准备的轻量图地址（优先 webp，其次 jpg）
  var panoMobileWebP = '手机-01.webp';  // 建议 4096x2048，2-5MB
  var panoMobileJPG  = '手机-01.jpg';
  var panoURL = supportsWebP ? panoMobileWebP : panoMobileJPG;

  // 点按钮再初始化全景，避免首屏压力
  document.getElementById('enter360').addEventListener('click', function(){
    var btn = this;
    btn.disabled = true; btn.textContent = '加载中…';

    // WebGL 能力检测（失败则兜底）
    try {
      var c = document.createElement('canvas');
      var gl = c.getContext('webgl') || c.getContext('experimental-webgl');
      if (!gl) throw new Error('No WebGL');
    } catch(e) {
      document.getElementById('m-pano').innerHTML =
        '<div style="color:#fff;display:grid;place-items:center;height:100%;">设备不支持全景预览。<a href="index.html?desktop=1" style="color:#ff4d4f">试试桌面版</a></div>';
      btn.remove();
      document.getElementById('m-pano').hidden = false;
      return;
    }

    var el = document.getElementById('m-pano');
    el.hidden = false; btn.remove();

    try {
      pannellum.viewer('m-pano', {
        type: 'equirectangular',
        panorama: panoURL,
        autoLoad: true,
        showControls: true,

        // 性能友好：固定视场角，减少缩放带来的开销
        mouseZoom: false, keyboardZoom: false, doubleClickZoom: false, showZoomCtrl: false,
        hfov: 90, minHfov: 90, maxHfov: 90,

        // 合理的初始与限制
        yaw: 0, pitch: 10, minYaw: -100, maxYaw: 100, minPitch: -40, maxPitch: 45,
        compass: false,

        // 可选：打开重力感应（有些 iOS 需手动允许）
        orientationOnByDefault: true
      });
    } catch (e) {
      el.innerHTML =
        '<div style="color:#fff;display:grid;place-items:center;height:100%;">加载失败，可能是图片跨域或过大。<a href="index.html?desktop=1" style="color:#ff4d4f">转到桌面版</a></div>';
    }
  });
</script>
